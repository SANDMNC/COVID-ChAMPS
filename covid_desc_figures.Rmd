---
title: "covid_figures"
output: html_document
---

```{r setup, include=FALSE}

#We can move all the plots to make figures to this script

knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(dplyr)
library(tidyselect) # for starts_with and contains

#read in data
covid_data_child <- read.csv("scored_data/covid_data_child_scored.csv", header=TRUE, stringsAsFactors = FALSE)

```



```{r, echo=FALSE}

# SDQ - stacked bar plot

childvarnames <- names(covid_data_child)
SDQ2vars <- vars_select(childvarnames, contains("SDQ.2"), -ends_with("_1"), -ends_with("_4"), -ends_with("_9"), -ends_with("_17"), -ends_with("_20"))
SDQdf<- covid_data_child[, SDQ2vars]
sdqvarnames<- names(SDQdf)
SDQ2numvars <- vars_select(sdqvarnames, contains("num"), -contains("_1_"), -contains("_4_"), -contains("_9_"), -contains("_17_"), -contains("_20_"))
SDQ2numdf<- covid_data_child[, SDQ2numvars]

# empty dataframe
SDQ.c.freq <- data.frame(matrix(ncol = 3, nrow = ncol(SDQ2numdf), dimnames=list(NULL, c("Less", "Same", "More"))))

for (i in 1:ncol(SDQ2numdf)) {
  #Get less
  SDQ.c.freq[i,1] <- as.data.frame(table(SDQ2numdf[,i]))[1,2]
  #Get same
  SDQ.c.freq[i,2] <- as.data.frame(table(SDQ2numdf[,i]))[2,2]
  #Get more
  SDQ.c.freq[i,3] <- as.data.frame(table(SDQ2numdf[,i]))[3,2]
}

SDQ.c.freq$varname <- c("H - restless", "E - headaches", "C - temper","Pe - solitary", "C - obedient", "E - worries", "H - fidget", "Pe - friend", "C - fights", "E - unhappy", "Pe - liked", "H - distracted", "E - nervous", "C - lies", "Pe - bullied", "H - thinks", "C - steals", "Pe - adults", "E - fears", "H - attention")

#calculating the percentage of things of more/less/same for each item
 SDQ.c.freq$percentmore<- (SDQ.c.freq$More/rowSums(SDQ.c.freq[,c(1:3)]))*100
 SDQ.c.freq$percentsame<- (SDQ.c.freq$Same/rowSums(SDQ.c.freq[,c(1:3)]))*100
 SDQ.c.freq$percentless<- (SDQ.c.freq$Less/rowSums(SDQ.c.freq[,c(1:3)]))*100
 


less <- SDQ.c.freq[,c("percentless","varname")]
colnames(less)[1] <- "Percent"
less$change <- 'less'

same <- SDQ.c.freq[,c("percentsame","varname")]
colnames(same)[1] <- "Percent"
same$change <- 'same'

more <- SDQ.c.freq[,c("percentmore","varname")]
colnames(more)[1] <- "Percent"
more$change <- 'more'

#change the name here so  can have 2 different dataframes
percforplot <- rbind(less, same, more)

#Chnage order of the factors to chnage how th bars are stacked
percforplot$change <- factor(percforplot$change, levels = c('same', 'less', 'more'))


ggplot(percforplot, aes(fill=change, y= Percent, x= varname)) + 
    geom_bar(stat = "identity") +
    theme(axis.text.x = element_text(angle = 45)) + labs(x = "Child mental health (SDQ) problems")


```


