---
title: "covid_figures"
output: html_document
---

```{r setup, include=FALSE}

#We can move all the plots to make figures to this script

knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(dplyr)
library(tidyselect) # for starts_with and contains

#read in data
covid_data_child <- read.csv("covid_data_child_scored.csv", header=TRUE, stringsAsFactors = FALSE)

```



```{r, echo=FALSE}

# SDQ - stacked bar plot

childvarnames <- names(covid_data_child)
SDQ2vars <- vars_select(childvarnames, contains("SDQ.2"))
SDQdf<- covid_data_child[, SDQ2vars]
sdqvarnames<- names(SDQdf)
SDQ2numvars <- vars_select(sdqvarnames, contains("num"))
SDQ2numdf<- covid_data_child[, SDQ2numvars]

# empty dataframe
SDQ.c.freq <- data.frame(matrix(ncol = 3, nrow = ncol(SDQ2numdf), dimnames=list(NULL, c("Less", "Same", "More"))))

for (i in 1:ncol(SDQ2numdf)) {
  #Get less
  SDQ.c.freq[i,1] <- as.data.frame(table(SDQ2numdf[,i]))[1,2]
  #Get same
  SDQ.c.freq[i,2] <- as.data.frame(table(SDQ2numdf[,i]))[2,2]
  #Get more
  SDQ.c.freq[i,3] <- as.data.frame(table(SDQ2numdf[,i]))[3,2]
}

SDQ.c.freq$varname <- c("Pr - considerate", "H - restless", "E - headaches", "Pr - share", "C - temper","Pe - solitary", "C - obedient", "E - worries", "Pr - helpful", "H - fidget", "Pe - friend", "C - fights", "E - unhappy", "Pe - liked", "H - distracted", "E - nervous", "Pr - kind", "C - lies", "Pe - bullied", "Pr - volunteers", "H - thinks", "C - steals", "Pe - adults", "E - fears", "H - attention")

#calculating the percentage of things of more/less/same for each item
 SDQ.c.freq$percentmore<- (SDQ.c.freq$More/rowSums(SDQ.c.freq[,c(1:3)]))*100
 SDQ.c.freq$percentsame<- (SDQ.c.freq$Same/rowSums(SDQ.c.freq[,c(1:3)]))*100
 SDQ.c.freq$percentless<- (SDQ.c.freq$Less/rowSums(SDQ.c.freq[,c(1:3)]))*100
 


less <- SDQ.c.freq[,c("Less","varname")]
colnames(less)[1] <- "Freq"
less$change <- 'less'

same <- SDQ.c.freq[,c("Same","varname")]
colnames(same)[1] <- "Freq"
same$change <- 'same'

more <- SDQ.c.freq[,c("More","varname")]
colnames(more)[1] <- "Freq"
more$change <- 'more'

#change the name here so  can have 2 different dataframes
freqforplot <- rbind(less, same, more)

#Chnage order of the factors to chnage how th bars are stacked
freqforplot$change <- factor(freqforplot$change, levels = c('same', 'less', 'more'))


ggplot(freqforplot, aes(fill=change, y=Freq, x= varname)) + 
    geom_bar(stat = "identity") +
    theme(axis.text.x = element_text(angle = 45))


```


